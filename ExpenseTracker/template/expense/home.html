{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/pagescss/home.css'%}" />

<div class="card" style="width: 18rem;">
    {% for message in messages %}
    {% if "Error" in message %}
    <div class="alert alert-danger">
        <a class="close" href="#" data-dismiss="alert">×</a>

        {{ message }}

    </div>

    {% else %}
    <div class="alert alert-success">
        <a class="close" href="#" data-dismiss="alert">×</a>

        {{ message }}

    </div>

    {% endif %}
    {% endfor %}
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModal">
                Add Expense
              </button>
              <button type="button" class="btn btn-success" data-toggle="modal" data-target="#catagorymodel">
                  Add Catagory
                </button>
              
              <div class="list-group">
                {% for expense in MyExpense%}
                    <a href="#" class="list-group-item list-group-item-action ">
                     £{{expense.Amount}} spent on {{expense.Catagory}} on {{expense.Date_Time}}
                    </a>
                    {%endfor%}
                  
                  </div>
</div>


      
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Expense</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                    <form method="POST" action="{% url 'home' %}">

                        {% csrf_token %}
                            <div class="form-group">
                              <label for="amount">Amount</label>
                              <input type="number" class="form-control" id="amount" name="amount" placeholder="10">
                            </div>
                        
                            <div class="form-group">
                              <label for="Catagory">Catagory</label>
                              <select class="form-control" id="catagory" name="catagory">
                                  <option  selected disabled="disabled"> Please Select Catagory</option>
                                {% for catagory in MyCatagories %}
                                <option value="{{catagory.Name}}">{{catagory.Name}}</option>
                              
                                {% endfor %}
                              </select>
                            </div>
                            <div class="form-group">
                                    <label for="exampleFormControlTextarea1">Contents</label>
                                    <textarea class="form-control" id="content" name="content" rows="3"></textarea>
                                  </div>
                        
                            <div class="form-group">
                              <label for="exampleFormControlTextarea1">Notes</label>
                              <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                            </div>
                   

            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save Expense</button>
            </div>
            
        </form>
          </div>
        </div>
      </div>


         <!-- Modal -->
         <div class="modal fade" id="catagorymodel" tabindex="-1" role="dialog" aria-labelledby="catagorymodel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Expense</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                        <form method="POST" action="{% url 'home' %}">
    
                            {% csrf_token %}
                                <div class="form-group">
                                  <label for="amount">Catagory Name</label>
                                  <input type="text" class="form-control" id="newcatagory" name="newcatagory" placeholder="Enter Catagory">
                                </div>
                            
                            
    
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Add Catagory</button>
                </div>
                
            </form>
              </div>
            </div>
          </div>

          <div class="form-group">
              <label for="exampleFormControlSelect1">Filter Graph</label>
              <select class="form-control" id="filteroptions">
                <option value="All">All</option>
                <option value="Today">Today</option>
                <option value="ThisWeek">This Week</option>
                <option value="LastWeek">Last Week</option>
                <option value="ThisMonth">This Month</option>
                <option value="LastMonth">Last Month</option>
              </select>
          
<div class="myLittleGraph" style="margin-left:10px">
  <div id="container" class="container" style="margin-left:-10px;"></div>
</div>
          <script>
              $( document ).ready(function() {
                piechart();
                linechart();
            });


              $('#filteroptions').on('change', function() {
                var time=this.value;
               
                localStorage.setItem('time', time);

                piechart();
                linechart();
              });

              

            
              function piechart(){
                var time=localStorage.getItem('time');
                $.ajax({
                  url: 'http://localhost:8000/chart_data'+'?time='+time,
                  dataType: 'json',
                  success: function (data) {
                    Highcharts.chart("container", data);
                  }
                });
              }
         
          </script>

          <div class="myLittleGraph" style="margin-left:10px">
              <div id="container1" class="container1" style="margin-left:-10px;"></div>
            </div>
                      <script>

                        function linechart(){
                          var time=localStorage.getItem('time');

                          $.ajax({
                             url: 'http://localhost:8000/line_chart'+'?time='+time,
                             dataType: 'json',
                             success: function (data) {
                               Highcharts.chart("container1", data);
                             }
                           });
                        }
                      </script>

{%endblock%}
<script type="text/javascript">
  $(function () {
      $('#datetimepicker1').datetimepicker();
  });
</script>